function Spin2WinWheel(){var r=this,C=document.querySelector(".wheelSVG"),d=document.querySelector(".wheel"),Q=document.querySelector(".wheelOutline"),I=document.querySelector(".peg"),ba=document.querySelector(".pegContainer"),xa=document.querySelector(".mainContainer"),z=document.querySelector(".valueContainer"),ca=document.querySelector(".centerCircle"),p=document.querySelector(".toast"),da=document.querySelector(".toast p"),b,R,ea,S,m,fa,ga,ha,ia,J,l,t,ja,ka,la,ma,na,oa,T,u,w,A,k,pa,K,n=0,f,g,
D,c=0,E=2,L=0,F=0,U=F,V=[],qa,ra,W,X,M,sa,ta,q,x=null,N,O,P,Y,v=[],ya=new Audio("media/wheel_tick.mp3"),e,B=!0,ua=function(){TweenMax.set("svg",{visibility:"visible"});TweenMax.set(d,{svgOrigin:f+" "+g,x:0,y:0});TweenMax.set(I,{x:f-I.getBBox().width/2,y:g-m-I.getBBox().height/2,transformOrigin:"50% 25%",visibility:"visible"});TweenMax.set(ba,{transformOrigin:"50% 100%",scale:S/600});TweenMax.set(xa,{svgOrigin:f+" "+g,rotation:-90,x:0,y:0});TweenMax.set([p],{xPercent:-50,left:"50%",top:"50%",yPercent:-50});
TweenMax.set("svg",{xPercent:-50,left:"50%",top:"50%",yPercent:-50})},za=function(){for(var a=0;a<w;a++){var b=document.createElementNS("http://www.w3.org/2000/svg","g");if("image"==u[a].type){var d=document.createElementNS("http://www.w3.org/2000/svg","image");b.appendChild(d);d.setAttribute("class","wheelImage");d.setAttributeNS(null,"x",f-J/2);d.setAttributeNS(null,"y",g-m+ha);d.setAttributeNS(null,"width",J);d.setAttributeNS(null,"height",J);d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",
u[a].value)}else if("string"==u[a].type){var e=document.createElementNS("http://www.w3.org/2000/svg","text"),c,h;u[a].value.split("^").forEach(function(a,b){c=document.createTextNode(a);h=document.createElementNS("http://www.w3.org/2000/svg","tspan");h.setAttributeNS(null,"dy",b?"1.2em":0);h.setAttributeNS(null,"x",f);h.setAttributeNS(null,"text-anchor","middle");h.appendChild(c);e.appendChild(h)});b.appendChild(e);e.setAttribute("class","wheelText");e.setAttributeNS(null,"fill",fa);e.setAttributeNS(null,
"x",f);e.setAttributeNS(null,"y",g-m+ga);e.style.fontSize=ia}z.appendChild(b);TweenMax.set(b,{svgOrigin:f+" "+g,rotation:a*k})}TweenMax.set(z,{svgOrigin:f+" "+g})},Aa=function(){var a=document.createElementNS("http://www.w3.org/2000/svg","g"),b=document.createElementNS("http://www.w3.org/2000/svg","circle");Q.appendChild(a);b.setAttributeNS(null,"fill","transparent");b.setAttributeNS(null,"stroke",R);b.setAttributeNS(null,"stroke-width",ea);b.setAttributeNS(null,"cx",f);b.setAttributeNS(null,"cy",
g);b.setAttributeNS(null,"r",m);a.appendChild(b);return a},Ba=function(){var a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"fill",la);a.setAttributeNS(null,"stroke",ja);a.setAttributeNS(null,"stroke-width",ka);a.setAttributeNS(null,"cx",f);a.setAttributeNS(null,"cy",g);a.setAttributeNS(null,"r",na);return a},Ca=function(){ya.play()},Da=function(){p.style.visibility="hidden"},Ea=function(){p.style.visibility="hidden";x.onclick=null;E+=2},Fa=function(){q||l[0].disable();
B&&(Y=VelocityTracker.track(d,"rotation"))},Z=function(a){K=n;n=Math.round(d._gsTransform.rotation/k);n!=K&&TweenMax.fromTo(I,.2,{rotation:n>K?-35:35},{onStart:sa?Ca:null,rotation:0,ease:Back.easeOut});TweenMax.set(z,{rotation:d._gsTransform.rotation})},Ga=function(){t=d._gsTransform.rotation;var a=Math.round(t%360),a=0<a?360-a:a,a=0>a?a*=-1:a;if(Y&&.5>=Y.getVelocity("rotation"))q||l[0].enable(),aa("invalidSpin");else{aa(Math.abs(Math.round(a/k)));if(B)if(-1<A)c++;else return;else c++,l[0].vars.snap=
[e[c]];VelocityTracker.untrack(d);c>=A?va():q||l[0].enable()}},Ha=function(a){return function(b){return Math.round(b/k)*k-a}},wa=function(){l=Draggable.create(d,{type:"rotation",bounds:{minRotation:-1E16,maxRotation:0},throwProps:!0,ease:Back.easeOut.config(.2),snap:B?Ha(0):[e[c]],throwResistance:0,minDuration:qa,onThrowComplete:Ga,onPress:Da,onDrag:Z,onThrowUpdate:Z,overshootTolerance:1,onDragEnd:Fa})},H=function(){return function(){ThrowPropsPlugin.to(d,{throwProps:{rotation:{velocity:Math.floor(201*
Math.random()+-700),end:B?-(k*Math.floor(Math.random()*(w-0+1)+0))-1080*E:[e[c]]}},onStart:Ea,onUpdate:Z,ease:Back.easeOut.config(.2),overshootTolerance:0,onComplete:Ia})}},Ia=function(){t=d._gsTransform.rotation;var a=Math.round(t%360),a=0<a?360-a:a,a=0>a?a*=-1:a;aa(Math.abs(Math.round(a/k)));if(B)if(-1<A)c++;else return;else c++;c>=A?va():x.onclick=H()},va=function(){q||l[0].disable();TweenMax.set(C,{alpha:.3});TweenMax.to(da,1,{text:ra,ease:Linear.easeNone,delay:2});O({gameId:M,target:r,results:v})},
aa=function(a){q||l[0].applyBounds({minRotation:-1E16,maxRotation:t});"invalidSpin"==a?(TweenMax.set(d,{rotation:e[c]}),y(W),a={target:r,type:"error",spinCount:c,win:null,msg:W,gameId:M},P(a),v.push(a)):isNaN(a)||(y(u[a].resultText),a={target:r,type:"result",spinCount:c,win:u[a].win,msg:u[a].resultText,gameId:M},N(a),v.push(a))},y=function(a){p.style.visibility="visible";p.style.backgroundColor="#E81D62";da.innerHTML=a;TweenMax.fromTo(p,.6,{y:20,alpha:0},{y:0,alpha:1,delay:.2,ease:Elastic.easeOut.config(.7,
.7)})};N=function(a){r.onResult(a)};P=function(a){r.onError(a)};O=function(a){r.onGameEnd(a)};this.onResult=N;this.onError=P;this.onGameEnd=O;this.getGameProgress=function(){return v};this.init=function(a){if(a){C.setAttribute("viewBox","0 0 "+a.data.svgWidth+" "+a.data.svgHeight);b=a.data;O=a.onGameEnd?a.onGameEnd:r.onGameEnd;N=a.onResult?a.onResult:r.onResult;P=a.onError?a.onError:r.onError;(x=a.spinTrigger?a.spinTrigger:null)&&(q=!0);q&&(x?x.onclick=H():d.onclick=H());R=b.wheelStrokeColor;S=b.wheelSize;
m=S/2;fa=b.wheelTextColor;R=b.wheelStrokeColor;ea=b.wheelStrokeWidth;ga=b.wheelTextOffsetY;ha=b.wheelImageOffsetY;J=b.wheelImageSize;ia=b.wheelTextSize;ja=b.centerCircleStrokeColor;ka=b.centerCircleStrokeWidth;la=b.centerCircleFillColor;ma=b.centerCircleSize;na=ma/2;oa=b.segmentStrokeColor;T=b.segmentStrokeWidth;u=b.segmentValuesArray;w=u.length;A=-1==b.numSpins?1E16:b.numSpins;qa=b.minSpinDuration;ra=b.gameOverText;W=b.invalidSpinText;X=b.introText;sa=b.hasSound;M=b.gameId;q=b.clickToSpin;k=360/
w;pa=k/2;f=b.centerX;g=b.centerY;D=b.colorArray;ta=b.hasShadows;e=b.spinDestinationArray;ta&&(Q.setAttributeNS(null,"filter","url(#shadow)"),z.setAttributeNS(null,"filter","url(#shadow)"),ca.setAttributeNS(null,"filter","url(#shadow)"),ba.setAttributeNS(null,"filter","url(#shadow)"),p.style.boxShadow="0px 0px 20px rgba(21,21,21,0.5)");ua();for(var c,l,t,n,h,v,G=0;G<w;G++)F=-pa,U=F+k,a=f+m*Math.cos(Math.PI*F/180),l=g+m*Math.sin(Math.PI*F/180),c=f+m*Math.cos(Math.PI*U/180),t=g+m*Math.sin(Math.PI*U/
180),n="M"+f+","+g+"  L"+a+","+l+"  A"+m+","+m+" 0 0,1 "+c+","+t+"z",v=document.createElementNS("http://www.w3.org/2000/svg","g"),h=document.createElementNS("http://www.w3.org/2000/svg","path"),v.appendChild(h),d.appendChild(v),TweenMax.set(h,{rotation:G*k,svgOrigin:f+" "+g}),h.setAttributeNS(null,"d",n),D[G]?n=D[G]:(n=D[L],L++,L==D.length&&(L=0)),h.setAttributeNS(null,"fill",n),h.setAttributeNS(null,"stroke",0),V.push({path:h,x1:a,x2:c,y1:l,y2:t});if(0<T)for(a=0;a<w;a++)c=document.createElementNS("http://www.w3.org/2000/svg",
"line"),c.setAttributeNS(null,"x1",f),c.setAttributeNS(null,"x2",V[a].x2),c.setAttributeNS(null,"y1",g),c.setAttributeNS(null,"y2",V[a].y2),c.setAttributeNS(null,"stroke",oa),c.setAttributeNS(null,"stroke-width",T),d.appendChild(c),TweenMax.set(c,{svgOrigin:f+" "+g,rotation:a*k});za();Q.appendChild(Aa());ca.appendChild(Ba());a:{if(0<e.length)for(B=!1,A=e.length,a=0;a<e.length;a++){if(e[a]>w||0===e[a]){y("Invalid destination set - please ensure the destination in spinDestinationArray is greater than 0 and less than or equal to the number of segments");
TweenMax.set(C,{visibility:"hidden"});p.style.backgroundColor="red";break a}--e[a];e[a]=-1*e[a]*k-1080*E;E+=2}q?x?x.onclick=H():(x=d,d.onclick=H()):wa();y(X)}1>=w&&(y("Not enough segments. Please add more entries to segmentValuesArray"),TweenMax.set(C,{visibility:"hidden"}),p.style.backgroundColor="red")}else ua(),y("PLEASE INCLUDE THE INIT OBJECT")};this.restart=function(){q||(l[0].kill(),n=K=null,TweenMax.to([d,z],.3,{rotation:"0_short",onComplete:wa}));TweenMax.set(C,{alpha:1});TweenMax.to([d,
z],.3,{rotation:"0_short"});p.style.visibility="hidden";c=0;E=2;v=[];y(X)}};